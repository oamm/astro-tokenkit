
> astro-tokenkit@1.0.13 test D:\Git\astro-tokenkit
> vitest run
 RUN  v1.6.1 D:/Git/astro-tokenkit
   ❯ Promise behavior (.then, .catch, .finally) (4)
     ✓ should support .then, .catch, .finally on regular requests
     \ should support .catch and .finally on failed requests
   ❯ Promise behavior (.then, .catch, .finally) (4)
     ✓ should support .then, .catch, .finally on regular requests
     | should support .catch and .finally on failed requests
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/field-mapping.test.ts (4)
 ✓ tests/middleware-custom-store.test.ts (2)
 ✓ tests/error-handling.test.ts (4)
 ✓ tests/config.test.ts (1)
 ✓ tests/singleton.test.ts (5)
 ✓ tests/multi-tenant.test.ts (5)
 ✓ tests/context.test.ts (6)
 ✓ tests/security.test.ts (5)
 ✓ tests/promises.test.ts (4) 3019ms
 ✓ tests/auth-config.test.ts (2)
 ✓ tests/onLogin.test.ts (2)
 ✓ tests/onError.test.ts (3)
 ❯ tests/client.test.ts (6)
   ❯ APIClient with global config (6)
     ✓ should use global config in login
     ✓ should use external context from global config in request
     ✓ should use middleware to bind context and rotate tokens via global config
     ✓ should skip runWithContext in middleware if getContextStore is defined globally
     ✓ should NOT skip runWithContext in middleware if both getContextStore and runWithContext are defined globally
     × should initialize context store via setContextStore if getContextStore returns null
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
 FAIL  tests/client.test.ts > APIClient with global config > should initialize context store via setContextStore if getContextStore returns null
AssertionError: expected "spy" to be called at least once
 ❯ tests/client.test.ts:185:33
    183|         expect(result).toBe('next-result');
    184|         expect(next).toHaveBeenCalled();
    185|         expect(getContextStore).toHaveBeenCalled();
       |                                 ^
    186|         expect(setContextStore).toHaveBeenCalledWith(expect.objectCont…
    187|             cookies: mockAstro.cookies
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯
 Test Files  1 failed | 12 passed (13)
      Tests  1 failed | 48 passed (49)
   Start at  12:54:04
   Duration  3.48s (transform 397ms, setup 1ms, collect 1.21s, tests 3.22s, environment 2ms, prepare 1.91s)
 ELIFECYCLE  Test failed. See above for more details.