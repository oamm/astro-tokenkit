{"version":3,"file":"index.js","sources":["../node_modules/.pnpm/@rollup+plugin-typescript@1_f4cae68daad83bcc2cea3ce6e24f951a/node_modules/tslib/tslib.es6.js","../src/types.ts","../src/auth/detector.ts","../src/auth/storage.ts","../src/utils/time.ts","../src/auth/policy.ts","../src/auth/manager.ts","../src/client/context.ts","../src/utils/retry.ts","../src/client/client.ts","../src/middleware.ts","../src/integration.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","// packages/astro-tokenkit/src/types.ts\r\n\r\nimport type { AstroCookies } from 'astro';\r\nimport { AsyncLocalStorage } from 'node:async_hooks';\r\n\r\n/**\r\n * Token bundle returned from auth endpoints\r\n */\r\nexport interface TokenBundle {\r\n    accessToken: string;\r\n    refreshToken: string;\r\n    accessExpiresAt: number; // Unix timestamp in seconds\r\n    refreshExpiresAt?: number;\r\n    sessionPayload?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Minimal context required by TokenKit\r\n */\r\nexport interface TokenKitContext {\r\n    cookies: AstroCookies;\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Session information\r\n */\r\nexport interface Session {\r\n    accessToken: string;\r\n    expiresAt: number;\r\n    payload?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Request options\r\n */\r\nexport interface RequestOptions {\r\n    /** Astro context (optional if middleware binds it) */\r\n    ctx?: TokenKitContext;\r\n    /** Additional headers */\r\n    headers?: Record<string, string>;\r\n    /** Request timeout in ms */\r\n    timeout?: number;\r\n    /** Query parameters */\r\n    params?: Record<string, any>;\r\n    /** Skip authentication for this request */\r\n    skipAuth?: boolean;\r\n    /** Custom signal for cancellation */\r\n    signal?: AbortSignal;\r\n}\r\n\r\n/**\r\n * Request configuration\r\n */\r\nexport interface RequestConfig extends RequestOptions {\r\n    method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\r\n    url: string;\r\n    data?: any;\r\n}\r\n\r\n/**\r\n * HTTP response\r\n */\r\nexport interface APIResponse<T = any> {\r\n    data: T;\r\n    status: number;\r\n    statusText: string;\r\n    headers: Headers;\r\n    url: string;\r\n}\r\n\r\n/**\r\n * Field mapping for auto-detection\r\n */\r\nexport interface FieldMapping {\r\n    accessToken?: string;\r\n    refreshToken?: string;\r\n    expiresAt?: string;\r\n    expiresIn?: string;\r\n    sessionPayload?: string;\r\n}\r\n\r\n/**\r\n * Auth configuration\r\n */\r\nexport interface AuthConfig {\r\n    /** Login endpoint (relative to baseURL) */\r\n    login: string;\r\n    /** Refresh endpoint (relative to baseURL) */\r\n    refresh: string;\r\n    /** Logout endpoint (optional, relative to baseURL) */\r\n    logout?: string;\r\n\r\n    /** Field mapping (auto-detected if not provided) */\r\n    fields?: FieldMapping;\r\n\r\n    /** Custom login response parser */\r\n    parseLogin?: (body: any) => TokenBundle;\r\n    /** Custom refresh response parser */\r\n    parseRefresh?: (body: any) => TokenBundle;\r\n\r\n    /** Custom token injection function (default: Bearer) */\r\n    injectToken?: (token: string) => string;\r\n\r\n    /** Refresh policy */\r\n    policy?: RefreshPolicy;\r\n\r\n    /** Cookie configuration */\r\n    cookies?: CookieConfig;\r\n}\r\n\r\n/**\r\n * Refresh policy\r\n */\r\nexport interface RefreshPolicy {\r\n    /** Refresh before expiry (e.g., '5m' or 300) */\r\n    refreshBefore?: string | number;\r\n    /** Clock skew tolerance (e.g., '1m' or 60) */\r\n    clockSkew?: string | number;\r\n    /** Minimum interval between refreshes (e.g., '30s' or 30) */\r\n    minInterval?: string | number;\r\n}\r\n\r\n/**\r\n * Cookie configuration\r\n */\r\nexport interface CookieConfig {\r\n    /** Secure flag (auto-detected from NODE_ENV if not set) */\r\n    secure?: boolean;\r\n    /** SameSite policy */\r\n    sameSite?: 'strict' | 'lax' | 'none';\r\n    /** Cookie domain */\r\n    domain?: string;\r\n    /** Cookie names prefix */\r\n    prefix?: string;\r\n}\r\n\r\n/**\r\n * Retry configuration\r\n */\r\nexport interface RetryConfig {\r\n    /** Number of retry attempts */\r\n    attempts?: number;\r\n    /** Status codes to retry */\r\n    statusCodes?: number[];\r\n    /** Backoff strategy */\r\n    backoff?: 'linear' | 'exponential';\r\n    /** Initial delay in ms */\r\n    delay?: number;\r\n}\r\n\r\n/**\r\n * Request interceptor\r\n */\r\nexport type RequestInterceptor = (\r\n    config: RequestConfig,\r\n    ctx?: TokenKitContext\r\n) => RequestConfig | Promise<RequestConfig>;\r\n\r\n/**\r\n * Response interceptor\r\n */\r\nexport type ResponseInterceptor = <T = any>(\r\n    response: APIResponse<T>,\r\n    ctx?: TokenKitContext\r\n) => APIResponse<T> | Promise<APIResponse<T>>;\r\n\r\n/**\r\n * Error interceptor\r\n */\r\nexport type ErrorInterceptor = (\r\n    error: APIError,\r\n    ctx?: TokenKitContext\r\n) => never | Promise<never>;\r\n\r\n/**\r\n * Interceptors configuration\r\n */\r\nexport interface InterceptorsConfig {\r\n    request?: RequestInterceptor[];\r\n    response?: ResponseInterceptor[];\r\n    error?: ErrorInterceptor[];\r\n}\r\n\r\n/**\r\n * Client configuration\r\n */\r\nexport interface ClientConfig {\r\n    /** Base URL for all requests */\r\n    baseURL: string;\r\n\r\n    /** Auth configuration (optional for non-auth clients) */\r\n    auth?: AuthConfig;\r\n\r\n    /** Default headers for all requests */\r\n    headers?: Record<string, string>;\r\n\r\n    /** Default timeout in ms */\r\n    timeout?: number;\r\n\r\n    /** Retry configuration */\r\n    retry?: RetryConfig;\r\n\r\n    /** Interceptors */\r\n    interceptors?: InterceptorsConfig;\r\n\r\n    /** External AsyncLocalStorage instance (optional) */\r\n    context?: AsyncLocalStorage<any>;\r\n\r\n    /** Method to get the context store (optional) */\r\n    getContextStore?: () => TokenKitContext | undefined | null;\r\n}\r\n\r\n/**\r\n * API Error\r\n */\r\nexport class APIError extends Error {\r\n    constructor(\r\n        message: string,\r\n        public status?: number,\r\n        public response?: any,\r\n        public request?: RequestConfig\r\n    ) {\r\n        super(message);\r\n        this.name = 'APIError';\r\n    }\r\n}\r\n\r\n/**\r\n * Authentication Error\r\n */\r\nexport class AuthError extends APIError {\r\n    constructor(message: string, status?: number, response?: any, request?: RequestConfig) {\r\n        super(message, status, response, request);\r\n        this.name = 'AuthError';\r\n    }\r\n}\r\n\r\n/**\r\n * Network Error\r\n */\r\nexport class NetworkError extends APIError {\r\n    constructor(message: string, request?: RequestConfig) {\r\n        super(message, undefined, undefined, request);\r\n        this.name = 'NetworkError';\r\n    }\r\n}\r\n\r\n/**\r\n * Timeout Error\r\n */\r\nexport class TimeoutError extends APIError {\r\n    constructor(message: string, request?: RequestConfig) {\r\n        super(message, undefined, undefined, request);\r\n        this.name = 'TimeoutError';\r\n    }\r\n}","// packages/astro-tokenkit/src/auth/detector.ts\r\n\r\nimport type { TokenBundle, FieldMapping } from '../types';\r\n\r\n/**\r\n * Common field names for access tokens\r\n */\r\nconst ACCESS_TOKEN_FIELDS = [\r\n    'access_token',\r\n    'accessToken',\r\n    'token',\r\n    'jwt',\r\n    'id_token',\r\n    'idToken',\r\n];\r\n\r\n/**\r\n * Common field names for refresh tokens\r\n */\r\nconst REFRESH_TOKEN_FIELDS = [\r\n    'refresh_token',\r\n    'refreshToken',\r\n    'refresh',\r\n];\r\n\r\n/**\r\n * Common field names for expiration timestamp\r\n */\r\nconst EXPIRES_AT_FIELDS = [\r\n    'expires_at',\r\n    'expiresAt',\r\n    'exp',\r\n    'expiry',\r\n];\r\n\r\n/**\r\n * Common field names for expires_in (seconds)\r\n */\r\nconst EXPIRES_IN_FIELDS = [\r\n    'expires_in',\r\n    'expiresIn',\r\n    'ttl',\r\n];\r\n\r\n/**\r\n * Common field names for session payload\r\n */\r\nconst SESSION_PAYLOAD_FIELDS = [\r\n    'user',\r\n    'profile',\r\n    'account',\r\n    'data',\r\n];\r\n\r\n/**\r\n * Auto-detect token fields from response body\r\n */\r\nexport function autoDetectFields(body: any, fieldMapping?: FieldMapping): TokenBundle {\r\n    // Helper to find field\r\n    const findField = (candidates: string[], mapping?: string): any => {\r\n        if (mapping && body[mapping] !== undefined) {\r\n            return body[mapping];\r\n        }\r\n        for (const candidate of candidates) {\r\n            if (body[candidate] !== undefined) {\r\n                return body[candidate];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n\r\n    // Detect access token\r\n    const accessToken = findField(ACCESS_TOKEN_FIELDS, fieldMapping?.accessToken);\r\n    if (!accessToken) {\r\n        throw new Error(\r\n            `Could not detect access token field. Tried: ${ACCESS_TOKEN_FIELDS.join(', ')}. ` +\r\n            `Provide custom parseLogin/parseRefresh or field mapping.`\r\n        );\r\n    }\r\n\r\n    // Detect refresh token\r\n    const refreshToken = findField(REFRESH_TOKEN_FIELDS, fieldMapping?.refreshToken);\r\n    if (!refreshToken) {\r\n        throw new Error(\r\n            `Could not detect refresh token field. Tried: ${REFRESH_TOKEN_FIELDS.join(', ')}. ` +\r\n            `Provide custom parseLogin/parseRefresh or field mapping.`\r\n        );\r\n    }\r\n\r\n    // Detect expiration\r\n    let accessExpiresAt: number | undefined;\r\n\r\n    // Try expires_at first (timestamp)\r\n    const expiresAtValue = findField(EXPIRES_AT_FIELDS, fieldMapping?.expiresAt);\r\n    if (expiresAtValue !== undefined) {\r\n        accessExpiresAt = typeof expiresAtValue === 'number'\r\n            ? expiresAtValue\r\n            : parseInt(expiresAtValue, 10);\r\n    }\r\n\r\n    // Try expires_in (seconds from now)\r\n    if (accessExpiresAt === undefined) {\r\n        const expiresInValue = findField(EXPIRES_IN_FIELDS, fieldMapping?.expiresIn);\r\n        if (expiresInValue !== undefined) {\r\n            const expiresIn = typeof expiresInValue === 'number'\r\n                ? expiresInValue\r\n                : parseInt(expiresInValue, 10);\r\n            accessExpiresAt = Math.floor(Date.now() / 1000) + expiresIn;\r\n        }\r\n    }\r\n\r\n    if (accessExpiresAt === undefined) {\r\n        throw new Error(\r\n            `Could not detect expiration field. Tried: ${[...EXPIRES_AT_FIELDS, ...EXPIRES_IN_FIELDS].join(', ')}. ` +\r\n            `Provide custom parseLogin/parseRefresh or field mapping.`\r\n        );\r\n    }\r\n\r\n    // Detect session payload (optional)\r\n    const sessionPayload = findField(SESSION_PAYLOAD_FIELDS, fieldMapping?.sessionPayload);\r\n\r\n    return {\r\n        accessToken,\r\n        refreshToken,\r\n        accessExpiresAt,\r\n        sessionPayload: sessionPayload || undefined,\r\n    };\r\n}\r\n\r\n/**\r\n * Parse JWT payload without verification (for reading only)\r\n */\r\nexport function parseJWTPayload(token: string): Record<string, any> | null {\r\n    try {\r\n        const parts = token.split('.');\r\n        if (parts.length !== 3) {\r\n            return null;\r\n        }\r\n\r\n        const payload = parts[1];\r\n        const decoded = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\r\n        return JSON.parse(decoded);\r\n    } catch {\r\n        return null;\r\n    }\r\n}","// packages/astro-tokenkit/src/auth/storage.ts\r\n\r\nimport type { TokenBundle, CookieConfig, TokenKitContext } from '../types';\r\n\r\n/**\r\n * Cookie names\r\n */\r\nexport interface CookieNames {\r\n    accessToken: string;\r\n    refreshToken: string;\r\n    expiresAt: string;\r\n    lastRefreshAt: string;\r\n}\r\n\r\n/**\r\n * Get cookie names with optional prefix\r\n */\r\nexport function getCookieNames(prefix?: string): CookieNames {\r\n    const p = prefix ? `${prefix}_` : '';\r\n    return {\r\n        accessToken: `${p}access_token`,\r\n        refreshToken: `${p}refresh_token`,\r\n        expiresAt: `${p}access_expires_at`,\r\n        lastRefreshAt: `${p}last_refresh_at`,\r\n    };\r\n}\r\n\r\n/**\r\n * Get cookie options with smart defaults\r\n */\r\nexport function getCookieOptions(config: CookieConfig = {}) {\r\n    const isProduction = process.env.NODE_ENV === 'production';\r\n\r\n    return {\r\n        secure: config.secure ?? isProduction,\r\n        sameSite: config.sameSite ?? 'lax' as const,\r\n        httpOnly: true, // Always HttpOnly for security\r\n        domain: config.domain,\r\n    };\r\n}\r\n\r\n/**\r\n * Store token bundle in cookies\r\n */\r\nexport function storeTokens(\r\n    ctx: TokenKitContext,\r\n    bundle: TokenBundle,\r\n    cookieConfig: CookieConfig = {}\r\n): void {\r\n    const names = getCookieNames(cookieConfig.prefix);\r\n    const options = getCookieOptions(cookieConfig);\r\n    const now = Math.floor(Date.now() / 1000);\r\n\r\n    // Calculate max age\r\n    const accessMaxAge = Math.max(0, bundle.accessExpiresAt - now);\r\n    const refreshMaxAge = bundle.refreshExpiresAt\r\n        ? Math.max(0, bundle.refreshExpiresAt - now)\r\n        : 7 * 24 * 60 * 60; // Default 7 days\r\n\r\n    // Set access token\r\n    ctx.cookies.set(names.accessToken, bundle.accessToken, {\r\n        ...options,\r\n        maxAge: accessMaxAge,\r\n        path: '/',\r\n    });\r\n\r\n    // Set refresh token (restricted path for security)\r\n    ctx.cookies.set(names.refreshToken, bundle.refreshToken, {\r\n        ...options,\r\n        maxAge: refreshMaxAge,\r\n        path: '/',\r\n    });\r\n\r\n    // Set expiration timestamp\r\n    ctx.cookies.set(names.expiresAt, bundle.accessExpiresAt.toString(), {\r\n        ...options,\r\n        maxAge: accessMaxAge,\r\n        path: '/',\r\n    });\r\n\r\n    // Set last refresh timestamp\r\n    ctx.cookies.set(names.lastRefreshAt, now.toString(), {\r\n        ...options,\r\n        maxAge: accessMaxAge,\r\n        path: '/',\r\n    });\r\n}\r\n\r\n/**\r\n * Retrieve tokens from cookies\r\n */\r\nexport function retrieveTokens(\r\n    ctx: TokenKitContext,\r\n    cookieConfig: CookieConfig = {}\r\n): {\r\n    accessToken: string | null;\r\n    refreshToken: string | null;\r\n    expiresAt: number | null;\r\n    lastRefreshAt: number | null;\r\n} {\r\n    const names = getCookieNames(cookieConfig.prefix);\r\n\r\n    const accessToken = ctx.cookies.get(names.accessToken)?.value || null;\r\n    const refreshToken = ctx.cookies.get(names.refreshToken)?.value || null;\r\n\r\n    const expiresAtStr = ctx.cookies.get(names.expiresAt)?.value;\r\n    const expiresAt = expiresAtStr ? parseInt(expiresAtStr, 10) : null;\r\n\r\n    const lastRefreshAtStr = ctx.cookies.get(names.lastRefreshAt)?.value;\r\n    const lastRefreshAt = lastRefreshAtStr ? parseInt(lastRefreshAtStr, 10) : null;\r\n\r\n    return { accessToken, refreshToken, expiresAt, lastRefreshAt };\r\n}\r\n\r\n/**\r\n * Clear all auth cookies\r\n */\r\nexport function clearTokens(ctx: TokenKitContext, cookieConfig: CookieConfig = {}): void {\r\n    const names = getCookieNames(cookieConfig.prefix);\r\n    const options = getCookieOptions(cookieConfig);\r\n\r\n    ctx.cookies.delete(names.accessToken, { ...options, path: '/' });\r\n    ctx.cookies.delete(names.refreshToken, { ...options, path: '/' });\r\n    ctx.cookies.delete(names.expiresAt, { ...options, path: '/' });\r\n    ctx.cookies.delete(names.lastRefreshAt, { ...options, path: '/' });\r\n}","// packages/astro-tokenkit/src/utils/time.ts\r\n\r\n/**\r\n * Parse time string to seconds\r\n * Supports: '5m', '30s', '1h', '2d'\r\n */\r\nexport function parseTime(input: string | number): number {\r\n    if (typeof input === 'number') {\r\n        return input;\r\n    }\r\n\r\n    const match = input.match(/^(\\d+)([smhd])$/);\r\n    if (!match) {\r\n        throw new Error(`Invalid time format: ${input}. Use format like '5m', '30s', '1h', '2d'`);\r\n    }\r\n\r\n    const value = parseInt(match[1], 10);\r\n    const unit = match[2];\r\n\r\n    const multipliers = {\r\n        s: 1,\r\n        m: 60,\r\n        h: 60 * 60,\r\n        d: 60 * 60 * 24,\r\n    };\r\n\r\n    return value * multipliers[unit as keyof typeof multipliers];\r\n}\r\n\r\n/**\r\n * Format seconds to human-readable string\r\n */\r\nexport function formatTime(seconds: number): string {\r\n    if (seconds < 60) return `${seconds}s`;\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;\r\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h`;\r\n    return `${Math.floor(seconds / 86400)}d`;\r\n}","// packages/astro-tokenkit/src/auth/policy.ts\r\n\r\nimport type { RefreshPolicy } from '../types';\r\nimport { parseTime } from '../utils/time';\r\n\r\n/**\r\n * Default refresh policy\r\n */\r\nexport const DEFAULT_POLICY = {\r\n    refreshBefore: 300, // 5 minutes\r\n    clockSkew: 60, // 1 minute\r\n    minInterval: 30, // 30 seconds\r\n};\r\n\r\n/**\r\n * Normalize refresh policy (convert time strings to seconds)\r\n */\r\nexport function normalizePolicy(policy: RefreshPolicy = {}): Required<RefreshPolicy> {\r\n    return {\r\n        refreshBefore: policy.refreshBefore\r\n            ? parseTime(policy.refreshBefore)\r\n            : DEFAULT_POLICY.refreshBefore,\r\n        clockSkew: policy.clockSkew\r\n            ? parseTime(policy.clockSkew)\r\n            : DEFAULT_POLICY.clockSkew,\r\n        minInterval: policy.minInterval\r\n            ? parseTime(policy.minInterval)\r\n            : DEFAULT_POLICY.minInterval,\r\n    };\r\n}\r\n\r\n/**\r\n * Check if token should be refreshed\r\n */\r\nexport function shouldRefresh(\r\n    expiresAt: number,\r\n    now: number,\r\n    lastRefreshAt: number | null,\r\n    policy: RefreshPolicy = {}\r\n): boolean {\r\n    const normalized = normalizePolicy(policy);\r\n    const refreshBefore = typeof normalized.refreshBefore === 'number'\r\n        ? normalized.refreshBefore\r\n        : parseTime(normalized.refreshBefore);\r\n    const clockSkew = typeof normalized.clockSkew === 'number'\r\n        ? normalized.clockSkew\r\n        : parseTime(normalized.clockSkew);\r\n    const minInterval = typeof normalized.minInterval === 'number'\r\n        ? normalized.minInterval\r\n        : parseTime(normalized.minInterval);\r\n\r\n    // Adjust for clock skew\r\n    const adjustedNow = now + clockSkew;\r\n\r\n    // Check if near expiration\r\n    const timeUntilExpiry = expiresAt - adjustedNow;\r\n    if (timeUntilExpiry > refreshBefore) {\r\n        return false;\r\n    }\r\n\r\n    // Check minimum interval\r\n    if (lastRefreshAt !== null) {\r\n        const timeSinceLastRefresh = now - lastRefreshAt;\r\n        if (timeSinceLastRefresh < minInterval) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * Check if token is expired\r\n */\r\nexport function isExpired(\r\n    expiresAt: number,\r\n    now: number,\r\n    policy: RefreshPolicy = {}\r\n): boolean {\r\n    const normalized = normalizePolicy(policy);\r\n    const clockSkew = typeof normalized.clockSkew === 'number'\r\n        ? normalized.clockSkew\r\n        : parseTime(normalized.clockSkew);\r\n\r\n    return now > expiresAt + clockSkew;\r\n}","// packages/astro-tokenkit/src/auth/manager.ts\r\n\r\nimport type { TokenBundle, Session, AuthConfig, TokenKitContext } from '../types';\r\nimport { autoDetectFields, parseJWTPayload } from './detector';\r\nimport { storeTokens, retrieveTokens, clearTokens } from './storage';\r\nimport { shouldRefresh, isExpired } from './policy';\r\n\r\n/**\r\n * Single-flight refresh manager\r\n */\r\nclass SingleFlight {\r\n    private inFlight = new Map<string, Promise<TokenBundle | null>>();\r\n\r\n    async execute(\r\n        key: string,\r\n        fn: () => Promise<TokenBundle | null>\r\n    ): Promise<TokenBundle | null> {\r\n        const existing = this.inFlight.get(key);\r\n        if (existing) return existing;\r\n\r\n        const promise = this.doExecute(key, fn);\r\n        this.inFlight.set(key, promise);\r\n        return promise;\r\n    }\r\n\r\n    private async doExecute(\r\n        key: string,\r\n        fn: () => Promise<TokenBundle | null>\r\n    ): Promise<TokenBundle | null> {\r\n        try {\r\n            return await fn();\r\n        } finally {\r\n            this.inFlight.delete(key);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Token Manager handles all token operations\r\n */\r\nexport class TokenManager {\r\n    private singleFlight = new SingleFlight();\r\n    private baseURL: string;\r\n\r\n    constructor(\r\n        private config: AuthConfig,\r\n        baseURL: string\r\n    ) {\r\n        this.baseURL = baseURL;\r\n    }\r\n\r\n    /**\r\n     * Perform login\r\n     */\r\n    async login(ctx: TokenKitContext, credentials: any): Promise<TokenBundle> {\r\n        const url = this.baseURL + this.config.login;\r\n\r\n        const response = await fetch(url, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(credentials),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Login failed: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        const body = await response.json();\r\n\r\n        // Parse response\r\n        const bundle = this.config.parseLogin\r\n            ? this.config.parseLogin(body)\r\n            : autoDetectFields(body, this.config.fields);\r\n\r\n        // Store in cookies\r\n        storeTokens(ctx, bundle, this.config.cookies);\r\n\r\n        return bundle;\r\n    }\r\n\r\n    /**\r\n     * Perform token refresh\r\n     */\r\n    async refresh(ctx: TokenKitContext, refreshToken: string): Promise<TokenBundle | null> {\r\n        const url = this.baseURL + this.config.refresh;\r\n\r\n        try {\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ refreshToken }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                // 401/403 = invalid refresh token\r\n                if (response.status === 401 || response.status === 403) {\r\n                    clearTokens(ctx, this.config.cookies);\r\n                    return null;\r\n                }\r\n                throw new Error(`Refresh failed: ${response.status} ${response.statusText}`);\r\n            }\r\n\r\n            const body = await response.json();\r\n\r\n            // Parse response\r\n            const bundle = this.config.parseRefresh\r\n                ? this.config.parseRefresh(body)\r\n                : autoDetectFields(body, this.config.fields);\r\n\r\n            // Validate bundle\r\n            if (!bundle.accessToken || !bundle.refreshToken || !bundle.accessExpiresAt) {\r\n                throw new Error('Invalid token bundle returned from refresh endpoint');\r\n            }\r\n\r\n            // Store new tokens\r\n            storeTokens(ctx, bundle, this.config.cookies);\r\n\r\n            return bundle;\r\n        } catch (error) {\r\n            clearTokens(ctx, this.config.cookies);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensure valid tokens (with automatic refresh)\r\n     */\r\n    async ensure(ctx: TokenKitContext): Promise<Session | null> {\r\n        const now = Math.floor(Date.now() / 1000);\r\n        const tokens = retrieveTokens(ctx, this.config.cookies);\r\n\r\n        // No tokens\r\n        if (!tokens.accessToken || !tokens.refreshToken || !tokens.expiresAt) {\r\n            return null;\r\n        }\r\n\r\n        // Token expired\r\n        if (isExpired(tokens.expiresAt, now, this.config.policy)) {\r\n            const flightKey = this.createFlightKey(tokens.refreshToken);\r\n            const bundle = await this.singleFlight.execute(flightKey, () =>\r\n                this.refresh(ctx, tokens.refreshToken!)\r\n            );\r\n\r\n            if (!bundle) return null;\r\n\r\n            return {\r\n                accessToken: bundle.accessToken,\r\n                expiresAt: bundle.accessExpiresAt,\r\n                payload: bundle.sessionPayload ?? parseJWTPayload(bundle.accessToken) ?? undefined,\r\n            };\r\n        }\r\n\r\n        // Proactive refresh\r\n        if (shouldRefresh(tokens.expiresAt, now, tokens.lastRefreshAt, this.config.policy)) {\r\n            const flightKey = this.createFlightKey(tokens.refreshToken);\r\n            const bundle = await this.singleFlight.execute(flightKey, () =>\r\n                this.refresh(ctx, tokens.refreshToken!)\r\n            );\r\n\r\n            if (bundle) {\r\n                return {\r\n                    accessToken: bundle.accessToken,\r\n                    expiresAt: bundle.accessExpiresAt,\r\n                    payload: bundle.sessionPayload ?? parseJWTPayload(bundle.accessToken) ?? undefined,\r\n                };\r\n            }\r\n\r\n            // Refresh failed, check if tokens still exist\r\n            const currentTokens = retrieveTokens(ctx, this.config.cookies);\r\n            if (!currentTokens.accessToken) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        // Return current session\r\n        return {\r\n            accessToken: tokens.accessToken,\r\n            expiresAt: tokens.expiresAt,\r\n            payload: parseJWTPayload(tokens.accessToken) ?? undefined,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Logout (clear tokens)\r\n     */\r\n    async logout(ctx: TokenKitContext): Promise<void> {\r\n        // Optionally call logout endpoint\r\n        if (this.config.logout) {\r\n            try {\r\n                const url = this.baseURL + this.config.logout;\r\n                await fetch(url, { method: 'POST' });\r\n            } catch (error) {\r\n                // Ignore logout endpoint errors\r\n                console.warn('Logout endpoint failed:', error);\r\n            }\r\n        }\r\n\r\n        clearTokens(ctx, this.config.cookies);\r\n    }\r\n\r\n    /**\r\n     * Get current session (no refresh)\r\n     */\r\n    getSession(ctx: TokenKitContext): Session | null {\r\n        const tokens = retrieveTokens(ctx, this.config.cookies);\r\n\r\n        if (!tokens.accessToken || !tokens.expiresAt) {\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            accessToken: tokens.accessToken,\r\n            expiresAt: tokens.expiresAt,\r\n            payload: parseJWTPayload(tokens.accessToken) ?? undefined,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Check if authenticated\r\n     */\r\n    isAuthenticated(ctx: TokenKitContext): boolean {\r\n        const tokens = retrieveTokens(ctx, this.config.cookies);\r\n        return !!(tokens.accessToken && tokens.refreshToken);\r\n    }\r\n\r\n    /**\r\n     * Create flight key for single-flight deduplication\r\n     */\r\n    private createFlightKey(token: string): string {\r\n        let hash = 0;\r\n        for (let i = 0; i < token.length; i++) {\r\n            const char = token.charCodeAt(i);\r\n            hash = ((hash << 5) - hash) + char;\r\n            hash = hash & hash;\r\n        }\r\n        return `flight_${Math.abs(hash).toString(36)}`;\r\n    }\r\n}","// packages/astro-tokenkit/src/client/context.ts\r\n\r\nimport { AsyncLocalStorage } from 'node:async_hooks';\r\nimport type { TokenKitContext } from '../types';\r\n\r\n/**\r\n * Async local storage for Astro context\r\n */\r\nconst defaultContextStorage = new AsyncLocalStorage<TokenKitContext>();\r\n\r\n/**\r\n * Configuration for context handling\r\n */\r\nexport interface ContextOptions {\r\n    context?: AsyncLocalStorage<any>;\r\n    getContextStore?: () => TokenKitContext | undefined | null;\r\n}\r\n\r\n/**\r\n * Bind Astro context for the current async scope\r\n */\r\nexport function bindContext<T>(ctx: TokenKitContext, fn: () => T, options?: ContextOptions): T {\r\n    const storage = options?.context || defaultContextStorage;\r\n    return storage.run(ctx, fn);\r\n}\r\n\r\n/**\r\n * Get current Astro context (from middleware binding or explicit)\r\n */\r\nexport function getContext(explicitCtx?: TokenKitContext, options?: ContextOptions): TokenKitContext {\r\n    const store = options?.getContextStore \r\n        ? options.getContextStore() \r\n        : (options?.context || defaultContextStorage).getStore();\r\n    \r\n    const ctx = explicitCtx || store;\r\n\r\n    if (!ctx) {\r\n        throw new Error(\r\n            'Astro context not found. Either:\\n' +\r\n            '1. Use api.middleware() to bind context automatically, or\\n' +\r\n            '2. Pass context explicitly: api.get(\"/path\", { ctx: Astro })'\r\n        );\r\n    }\r\n\r\n    return ctx;\r\n}\r\n\r\n/**\r\n * Check if context is available\r\n */\r\nexport function hasContext(explicitCtx?: TokenKitContext, options?: ContextOptions): boolean {\r\n    const store = options?.getContextStore \r\n        ? options.getContextStore() \r\n        : (options?.context || defaultContextStorage).getStore();\r\n\r\n    return !!(explicitCtx || store);\r\n}","// packages/astro-tokenkit/src/utils/retry.ts\r\n\r\nimport type { RetryConfig } from '../types';\r\n\r\n/**\r\n * Default retry configuration\r\n */\r\nexport const DEFAULT_RETRY: Required<RetryConfig> = {\r\n    attempts: 3,\r\n    statusCodes: [408, 429, 500, 502, 503, 504],\r\n    backoff: 'exponential',\r\n    delay: 1000,\r\n};\r\n\r\n/**\r\n * Calculate retry delay\r\n */\r\nexport function calculateDelay(\r\n    attempt: number,\r\n    config: RetryConfig = {}\r\n): number {\r\n    const { backoff = DEFAULT_RETRY.backoff, delay = DEFAULT_RETRY.delay } = config;\r\n\r\n    if (backoff === 'linear') {\r\n        return delay * attempt;\r\n    }\r\n\r\n    // Exponential backoff: delay * 2^(attempt-1)\r\n    return delay * Math.pow(2, attempt - 1);\r\n}\r\n\r\n/**\r\n * Check if error should be retried\r\n */\r\nexport function shouldRetry(\r\n    status: number | undefined,\r\n    attempt: number,\r\n    config: RetryConfig = {}\r\n): boolean {\r\n    const {\r\n        attempts = DEFAULT_RETRY.attempts,\r\n        statusCodes = DEFAULT_RETRY.statusCodes,\r\n    } = config;\r\n\r\n    if (attempt >= attempts) {\r\n        return false;\r\n    }\r\n\r\n    if (status === undefined) {\r\n        // Network errors are retryable\r\n        return true;\r\n    }\r\n\r\n    return statusCodes.includes(status);\r\n}\r\n\r\n/**\r\n * Sleep for given milliseconds\r\n */\r\nexport function sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n}","// packages/astro-tokenkit/src/client/client.ts\r\n\r\nimport type {APIResponse, ClientConfig, RequestConfig, RequestOptions, Session, TokenKitContext,} from '../types';\r\nimport {APIError, AuthError, NetworkError, TimeoutError} from '../types';\r\nimport {TokenManager} from '../auth/manager';\r\nimport {type ContextOptions, getContext} from './context';\r\nimport {calculateDelay, shouldRetry, sleep} from '../utils/retry';\r\n\r\n/**\r\n * API Client\r\n */\r\nexport class APIClient {\r\n    public tokenManager?: TokenManager;\r\n    private config: ClientConfig;\r\n    public contextOptions: ContextOptions;\r\n\r\n    constructor(config: ClientConfig) {\r\n        this.config = config;\r\n        this.contextOptions = {\r\n            context: config.context,\r\n            getContextStore: config.getContextStore,\r\n        };\r\n\r\n        // Initialize token manager if auth is configured\r\n        if (config.auth) {\r\n            this.tokenManager = new TokenManager(config.auth, config.baseURL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * GET request\r\n     */\r\n    async get<T = any>(url: string, options?: RequestOptions): Promise<T> {\r\n        return this.request<T>({\r\n            method: 'GET',\r\n            url,\r\n            ...options,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * POST request\r\n     */\r\n    async post<T = any>(url: string, data?: any, options?: RequestOptions): Promise<T> {\r\n        return this.request<T>({\r\n            method: 'POST',\r\n            url,\r\n            data,\r\n            ...options,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * PUT request\r\n     */\r\n    async put<T = any>(url: string, data?: any, options?: RequestOptions): Promise<T> {\r\n        return this.request<T>({\r\n            method: 'PUT',\r\n            url,\r\n            data,\r\n            ...options,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * PATCH request\r\n     */\r\n    async patch<T = any>(url: string, data?: any, options?: RequestOptions): Promise<T> {\r\n        return this.request<T>({\r\n            method: 'PATCH',\r\n            url,\r\n            data,\r\n            ...options,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * DELETE request\r\n     */\r\n    async delete<T = any>(url: string, options?: RequestOptions): Promise<T> {\r\n        return this.request<T>({\r\n            method: 'DELETE',\r\n            url,\r\n            ...options,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Generic request method\r\n     */\r\n    async request<T = any>(config: RequestConfig): Promise<T> {\r\n        const ctx = getContext(config.ctx, this.contextOptions);\r\n        let attempt = 0;\r\n        let lastError: Error | undefined;\r\n\r\n        while (true) {\r\n            attempt++;\r\n\r\n            try {\r\n                const response = await this.executeRequest<T>(config, ctx, attempt);\r\n                return response.data;\r\n            } catch (error) {\r\n                lastError = error as Error;\r\n\r\n                // Check if we should retry\r\n                if (shouldRetry((error as APIError).status, attempt, this.config.retry)) {\r\n                    const delay = calculateDelay(attempt, this.config.retry);\r\n                    await sleep(delay);\r\n                    continue;\r\n                }\r\n\r\n                // No more retries\r\n                throw error;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Execute single request\r\n     */\r\n    private async executeRequest<T>(\r\n        config: RequestConfig,\r\n        ctx: TokenKitContext,\r\n        attempt: number\r\n    ): Promise<APIResponse<T>> {\r\n        // Ensure valid session (if auth is enabled)\r\n        if (this.tokenManager && !config.skipAuth) {\r\n            await this.tokenManager.ensure(ctx);\r\n        }\r\n\r\n        // Build full URL\r\n        const fullURL = this.buildURL(config.url, config.params);\r\n\r\n        // Build headers\r\n        const headers = this.buildHeaders(config, ctx);\r\n\r\n        // Build request init\r\n        const init: RequestInit = {\r\n            method: config.method,\r\n            headers,\r\n            signal: config.signal,\r\n        };\r\n\r\n        // Add body for non-GET requests\r\n        if (config.data && config.method !== 'GET') {\r\n            init.body = JSON.stringify(config.data);\r\n        }\r\n\r\n        // Apply request interceptors\r\n        let requestConfig = { ...config };\r\n        if (this.config.interceptors?.request) {\r\n            for (const interceptor of this.config.interceptors.request) {\r\n                requestConfig = await interceptor(requestConfig, ctx);\r\n            }\r\n        }\r\n\r\n        // Execute fetch with timeout\r\n        const timeout = config.timeout ?? this.config.timeout ?? 30000;\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n        try {\r\n            const response = await fetch(fullURL, {\r\n                ...init,\r\n                signal: controller.signal,\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n\r\n            // Handle 401 (try refresh and retry once)\r\n            if (response.status === 401 && this.tokenManager && !config.skipAuth && attempt === 1) {\r\n                // Clear and try fresh session\r\n                const session = await this.tokenManager.ensure(ctx);\r\n                if (session) {\r\n                    // Retry with new token\r\n                    return this.executeRequest<T>(config, ctx, attempt + 1);\r\n                }\r\n            }\r\n\r\n            // Parse response\r\n            const apiResponse = await this.parseResponse<T>(response, fullURL);\r\n\r\n            // Apply response interceptors\r\n            if (this.config.interceptors?.response) {\r\n                let interceptedResponse = apiResponse;\r\n                for (const interceptor of this.config.interceptors.response) {\r\n                    interceptedResponse = await interceptor(interceptedResponse, ctx);\r\n                }\r\n                return interceptedResponse;\r\n            }\r\n\r\n            return apiResponse;\r\n        } catch (error) {\r\n            clearTimeout(timeoutId);\r\n\r\n            // Apply error interceptors\r\n            if (this.config.interceptors?.error) {\r\n                for (const interceptor of this.config.interceptors.error) {\r\n                    await interceptor(error as APIError, ctx);\r\n                }\r\n            }\r\n\r\n            // Transform errors\r\n            if (error instanceof Error && error.name === 'AbortError') {\r\n                throw new TimeoutError(`Request timeout after ${timeout}ms`, requestConfig);\r\n            }\r\n\r\n            if (error instanceof APIError) {\r\n                throw error;\r\n            }\r\n\r\n            throw new NetworkError((error as Error).message, requestConfig);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Parse response\r\n     */\r\n    private async parseResponse<T>(response: Response, url: string): Promise<APIResponse<T>> {\r\n        let data: T;\r\n\r\n        // Try to parse JSON\r\n        const contentType = response.headers.get('content-type');\r\n        if (contentType?.includes('application/json')) {\r\n            try {\r\n                data = await response.json();\r\n            } catch {\r\n                data = await response.text() as any;\r\n            }\r\n        } else {\r\n            data = await response.text() as any;\r\n        }\r\n\r\n        // Check if response is ok\r\n        if (!response.ok) {\r\n            if (response.status === 401 || response.status === 403) {\r\n                throw new AuthError(\r\n                    `Authentication failed: ${response.status} ${response.statusText}`,\r\n                    response.status,\r\n                    data\r\n                );\r\n            }\r\n\r\n            throw new APIError(\r\n                `Request failed: ${response.status} ${response.statusText}`,\r\n                response.status,\r\n                data\r\n            );\r\n        }\r\n\r\n        return {\r\n            data,\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n            headers: response.headers,\r\n            url,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Build full URL with query params\r\n     */\r\n    private buildURL(url: string, params?: Record<string, any>): string {\r\n        const fullURL = url.startsWith('http') ? url : this.config.baseURL + url;\r\n\r\n        if (!params) return fullURL;\r\n\r\n        const urlObj = new URL(fullURL);\r\n        Object.entries(params).forEach(([key, value]) => {\r\n            if (value !== undefined && value !== null) {\r\n                urlObj.searchParams.append(key, String(value));\r\n            }\r\n        });\r\n\r\n        return urlObj.toString();\r\n    }\r\n\r\n    /**\r\n     * Build request headers\r\n     */\r\n    private buildHeaders(config: RequestConfig, ctx: TokenKitContext): HeadersInit {\r\n        const headers: Record<string, string> = {\r\n            'Content-Type': 'application/json',\r\n            ...this.config.headers,\r\n            ...config.headers,\r\n        };\r\n\r\n        // Add auth token if available\r\n        if (this.tokenManager && !config.skipAuth) {\r\n            const session = this.tokenManager.getSession(ctx);\r\n            if (session?.accessToken) {\r\n                const injectFn = this.config.auth?.injectToken ?? ((token) => `Bearer ${token}`);\r\n                headers['Authorization'] = injectFn(session.accessToken);\r\n            }\r\n        }\r\n\r\n        return headers;\r\n    }\r\n\r\n    /**\r\n     * Login\r\n     */\r\n    async login(credentials: any, ctx?: TokenKitContext): Promise<void> {\r\n        if (!this.tokenManager) {\r\n            throw new Error('Auth is not configured for this client');\r\n        }\r\n\r\n        const context = getContext(ctx, this.contextOptions);\r\n        await this.tokenManager.login(context, credentials);\r\n    }\r\n\r\n    /**\r\n     * Logout\r\n     */\r\n    async logout(ctx?: TokenKitContext): Promise<void> {\r\n        if (!this.tokenManager) {\r\n            throw new Error('Auth is not configured for this client');\r\n        }\r\n\r\n        const context = getContext(ctx, this.contextOptions);\r\n        await this.tokenManager.logout(context);\r\n    }\r\n\r\n    /**\r\n     * Check if authenticated\r\n     */\r\n    isAuthenticated(ctx?: TokenKitContext): boolean {\r\n        if (!this.tokenManager) return false;\r\n\r\n        const context = getContext(ctx, this.contextOptions);\r\n        return this.tokenManager.isAuthenticated(context);\r\n    }\r\n\r\n    /**\r\n     * Get current session\r\n     */\r\n    getSession(ctx?: TokenKitContext): Session | null {\r\n        if (!this.tokenManager) return null;\r\n\r\n        const context = getContext(ctx, this.contextOptions);\r\n        return this.tokenManager.getSession(context);\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Create API client\r\n */\r\nexport function createClient(config: ClientConfig): APIClient {\r\n    return new APIClient(config);\r\n}","// packages/astro-tokenkit/src/middleware.ts\r\n\r\nimport type { MiddlewareHandler } from 'astro';\r\nimport type { APIClient } from './client/client';\r\nimport { bindContext } from './client/context';\r\n\r\n/**\r\n * Create middleware for context binding and automatic token rotation\r\n */\r\nexport function createMiddleware(client: APIClient): MiddlewareHandler {\r\n    return async (ctx, next) => {\r\n        const tokenManager = client.tokenManager;\r\n        const contextOptions = client.contextOptions;\r\n\r\n        const runLogic = async () => {\r\n            // Proactively ensure valid session if auth is configured\r\n            if (tokenManager) {\r\n                try {\r\n                    // This handles token rotation (refresh) if needed\r\n                    await tokenManager.ensure(ctx);\r\n                } catch (error) {\r\n                    // Log but don't block request if rotation fails\r\n                    console.error('[TokenKit] Automatic token rotation failed:', error);\r\n                }\r\n            }\r\n            return next();\r\n        };\r\n\r\n        // If getContextStore is defined, it means the context is managed externally (e.g., by a superior ALS)\r\n        // We skip bindContext to avoid nesting ALS.run() unnecessarily.\r\n        if (contextOptions?.getContextStore) {\r\n            return runLogic();\r\n        }\r\n\r\n        return bindContext(ctx, runLogic, contextOptions);\r\n    };\r\n}\r\n","// packages/astro-tokenkit/src/integration.ts\r\n\r\nimport type { AstroIntegration } from 'astro';\r\nimport type { APIClient } from './client/client';\r\nimport { createMiddleware } from './middleware';\r\n\r\n/**\r\n * Astro integration for TokenKit\r\n * \r\n * This integration facilitates the setup of TokenKit in an Astro project.\r\n */\r\nexport function tokenKit(client?: APIClient): AstroIntegration {\r\n    return {\r\n        name: 'astro-tokenkit',\r\n        hooks: {\r\n            'astro:config:setup': () => {\r\n                // Future-proofing: could add vite aliases or other setup here\r\n                console.log('[TokenKit] Integration initialized');\r\n            },\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Helper to define middleware in a separate file if needed\r\n */\r\nexport const defineMiddleware =\r\n    (client: APIClient) => createMiddleware(client);\r\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}